# 2025-12-27 工作汇总

## 一、插件系统架构

### 1. 创建插件目录结构
- 新建 `src/plugins/` 目录，用于存放独立的功能插件
- 每个插件包含独立的组件文件和元数据导出

### 2. 插件规范
```typescript
// 插件元数据格式
export const pluginMeta = {
  id: 'plugin-id',
  name: '插件名称',
  description: '插件描述',
  icon: 'IconName',  // lucide-react 图标名
  version: '1.0.0'
};
export default PluginComponent;
```

## 二、AI 工具模块

### 1. AI 工具入口页面
- 新建 `src/components/AITools.tsx`
- 卡片式展示所有可用插件
- 支持动态加载和切换插件

### 2. 导航栏更新
- 移除原有的 "SN-IBLF 查询" 导航项
- 新增 "AI工具" 导航项，路由 `/admin/tools`

## 三、已实现的插件

### 1. SN-IBLF 查询插件
- 位置：`src/plugins/sn-iblf/index.tsx`
- 功能：根据服务器 SN 查询对应的 IBLF 交换机
- API：`POST /api/sn-to-iblf`

### 2. SN 地址查询插件（新增）
- 位置：`src/plugins/sn-address/index.tsx`
- 功能：根据服务器 SN 查询带内/带外 IP 地址
- API：`POST /api/sn-to-address`
- 数据格式支持：
  ```
  SN,SN,SN,SN,SN,主机名,别名,带外地址,带内地址
  ```
- IP 段识别：
  - 带外（BMC）：10.240.8.x - 10.240.15.x
  - 带内（InBand）：10.240.0.x - 10.240.7.x

### 3. SN 拓扑查询插件（新增）
- 位置：`src/plugins/sn-topology/index.tsx`
- 功能：根据服务器 SN 查询网络连线拓扑，可视化展示
- API：`POST /api/sn-to-topology`
- 特性：
  - 可拖拽的拓扑图（基于 ReactFlow）
  - 多层级网络设备可视化：
    - 服务器层（Server）
    - IBLF 交换机层
    - SPINE 交换机层
    - CORE 核心交换机层
    - EDGE 边缘交换机层
    - LEAF 叶子交换机层（HSS-LEAF, STL-LEAF）
    - OOB 带外管理网络层（OOB-SPINE, OOB-LEAF）
  - 设备统计面板（显示各类型设备数量）
  - 连接详情表格（层级、源设备、端口、目标设备、端口、线缆类型）
  - 支持 POD 信息显示
- 依赖：`reactflow` 库

## 四、模型管理优化

### 1. API 配置功能
- 位置：`src/components/ModelSettings.tsx`
- 新增功能：
  - API Key 配置（支持显示/隐藏）
  - API 地址配置
  - 可展开的配置面板

### 2. 后端配置动态化
- 位置：`server/index.mjs`
- 新增 `getProviderConfig()` 函数
- Gemini 配置从硬编码改为从设置中读取
- 支持的提供商：SiliconFlow、Gemini

## 五、设置页面清理

### 1. 移除的内容
- 移除了 API 配置标签页（已迁移到模型管理）

### 2. 保留的内容
- 个人资料
- 服务器配置（后端服务器地址）
- 通知设置
- 隐私设置
- 数据备份

## 六、文件变更清单

### 新增文件
- `src/plugins/sn-iblf/index.tsx` - SN-IBLF 查询插件
- `src/plugins/sn-address/index.tsx` - SN 地址查询插件
- `src/plugins/sn-topology/index.tsx` - SN 拓扑查询插件
- `src/components/AITools.tsx` - AI 工具入口页面

### 修改文件
- `src/components/AdminLayout.tsx` - 导航栏更新
- `src/App.tsx` - 路由配置
- `src/components/ModelSettings.tsx` - API 配置功能
- `src/components/UserSettings.tsx` - 清理 API 配置
- `server/index.mjs` - 新增 API 端点，动态配置

## 七、使用说明

### 访问 AI 工具
1. 进入管理后台 `/admin`
2. 点击左侧导航栏 "AI工具"
3. 选择需要使用的工具

### 配置 API
1. 进入 `/admin/models`
2. 点击对应提供商的 "配置" 按钮
3. 输入 API Key 和 API 地址
4. 点击 "保存配置"

### 配置服务器地址
1. 进入 `/admin/settings`
2. 切换到 "服务器" 标签页
3. 输入后端服务器地址
4. 保存并刷新页面
