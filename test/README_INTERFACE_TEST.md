# æ¥å£çŠ¶æ€æŸ¥è¯¢æµ‹è¯• - ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ä¸“é—¨ç”¨äºè¯Šæ–­å’Œæå‡"å¦‚ä½•æŸ¥è¯¢æ¥å£çŠ¶æ€"ç±»æŸ¥è¯¢çš„æ£€ç´¢ç²¾åº¦ã€‚æµ‹è¯•ä¼šæ£€æµ‹é—®ç­”ç³»ç»Ÿå¯¹æ¥å£çŠ¶æ€ç›¸å…³æŸ¥è¯¢çš„å¤„ç†èƒ½åŠ›ã€‚

## å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ
npm run server
```

åç«¯æœåŠ¡å°†åœ¨ http://localhost:8787 å¯åŠ¨ã€‚

### 2. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ¥å£çŠ¶æ€æŸ¥è¯¢æµ‹è¯•
node test/interface-status-query-test.mjs

# æˆ–è€…æŒ‡å®šè‡ªå®šä¹‰APIåœ°å€
node test/interface-status-query-test.mjs --url=http://your-server:port/api/chunks/search
```

## æµ‹è¯•å†…å®¹

æµ‹è¯•åŒ…å«8ä¸ªä¸åŒç±»å‹çš„æŸ¥è¯¢åœºæ™¯ï¼š

### åŸºç¡€æŸ¥è¯¢ (basic)
- "å¦‚ä½•æŸ¥è¯¢æ¥å£çŠ¶æ€"
- "æ€ä¹ˆæŸ¥çœ‹ç«¯å£çŠ¶æ€"

### ç²¾ç¡®å‘½ä»¤ (exact)
- "nv show interface"
- "show interface status"

### ç‰¹å®šæ¥å£ (specific)
- "æŸ¥çœ‹swp1æ¥å£çŠ¶æ€"

### é«˜çº§æŸ¥è¯¢ (advanced)
- "æ¥å£up/downçŠ¶æ€æ€ä¹ˆçœ‹"
- "å¦‚ä½•æŸ¥çœ‹æ‰€æœ‰ç½‘å£çš„é“¾è·¯çŠ¶æ€"
- "æŸ¥çœ‹æ¥å£é€Ÿç‡å’Œå¸¦å®½"

## æµ‹è¯•ç»“æœè§£è¯»

### é€šè¿‡æ ‡å‡†

æ¯ä¸ªæŸ¥è¯¢éƒ½æœ‰æœŸæœ›çš„æ’åè¦æ±‚ï¼ˆminRankï¼‰ï¼š
- ç²¾ç¡®å‘½ä»¤æŸ¥è¯¢ï¼šTop 1-3
- åŸºç¡€æŸ¥è¯¢ï¼šTop 5
- é«˜çº§æŸ¥è¯¢ï¼šTop 5

æµ‹è¯•ä¼šæ£€æŸ¥è¿”å›ç»“æœä¸­æ˜¯å¦åŒ…å«æœŸæœ›çš„å…³é”®å†…å®¹ï¼Œå¦‚ï¼š
- `nv show interface`
- `show interface status`
- `interfaceçŠ¶æ€`
- `æ¥å£çŠ¶æ€`

### é—®é¢˜ç±»å‹

æµ‹è¯•ä¼šè¯†åˆ«å¹¶æŠ¥å‘Šä»¥ä¸‹é—®é¢˜ï¼š

1. **APIè¿æ¥é—®é¢˜** - åç«¯æœåŠ¡æœªå¯åŠ¨
2. **æ— ç»“æœé—®é¢˜** - çŸ¥è¯†åº“ç¼ºå°‘ç›¸å…³æ–‡æ¡£
3. **ç»“æœä¸ç›¸å…³** - æ£€ç´¢åˆ°å†…å®¹ä½†ä¸åŒ¹é…
4. **æ’ååä½** - æ‰¾åˆ°ç›¸å…³å†…å®¹ä½†æ’åé å

## å½“å‰é—®é¢˜è¯Šæ–­

æ ¹æ®ä½ çš„æè¿°"å¦‚ä½•æŸ¥è¯¢æ¥å£çŠ¶æ€éƒ½æ²¡æœ‰ååº”"ï¼Œå¯èƒ½çš„åŸå› æœ‰ï¼š

### æƒ…å†µ1: çŸ¥è¯†åº“ç¼ºå°‘ç›¸å…³æ–‡æ¡£ âŒ

**ç—‡çŠ¶**ï¼šæŸ¥è¯¢è¿”å›0ä¸ªç»“æœ

**è§£å†³æ–¹æ³•**ï¼š
1. å‡†å¤‡æ¥å£ç®¡ç†ç›¸å…³æ–‡æ¡£ï¼ˆPDF/Word/Markdownï¼‰
2. é€šè¿‡Webç•Œé¢ä¸Šä¼ åˆ°çŸ¥è¯†åº“
3. ç­‰å¾…æ–‡æ¡£å¤„ç†å’Œembeddingå®Œæˆ
4. é‡æ–°æµ‹è¯•

**æ¨èæ–‡æ¡£å†…å®¹**ï¼š
- NVIDIA Cumulus Linux æ¥å£ç®¡ç†æŒ‡å—
- `nv show interface` å‘½ä»¤å‚è€ƒ
- æ¥å£çŠ¶æ€æŸ¥è¯¢ç¤ºä¾‹
- ç½‘ç»œæ¥å£é…ç½®å’Œç›‘æ§æ–‡æ¡£

### æƒ…å†µ2: å…³é”®è¯æå–ä¸å‡†ç¡® âš ï¸

**ç—‡çŠ¶**ï¼šè¿”å›äº†ç»“æœä½†ä¸ç›¸å…³

**è§£å†³æ–¹æ³•**ï¼šä¼˜åŒ–å…³é”®è¯æå–å™¨

ç¼–è¾‘æ–‡ä»¶ï¼š`src/lib/enhancedNetworkKeywordExtractor.ts`

```typescript
// åœ¨æå–å™¨ä¸­æ·»åŠ æ¥å£ç›¸å…³çš„å¼ºå…³é”®è¯
const interfaceKeywords = [
  "æ¥å£", "interface", "ç«¯å£", "port",
  "çŠ¶æ€", "status", "é“¾è·¯", "link",
  "up", "down", "swp", "eth", "ç½‘å£"
];

// ç¡®ä¿è¿™äº›è¯ä¸ä¼šè¢«åœç”¨è¯è¿‡æ»¤
const stopWords = new Set([
  "çš„", "äº†", "æ˜¯", "åœ¨", "æœ‰", "å’Œ", "ä¸ª", "ä¸", "è¿™", "é‚£"
  // ä¸è¦åŒ…å« "æ¥å£", "çŠ¶æ€" ç­‰æŠ€æœ¯æœ¯è¯­
]);
```

### æƒ…å†µ3: æ£€ç´¢æƒé‡ä¸åˆç† âš ï¸

**ç—‡çŠ¶**ï¼šç›¸å…³ç»“æœæ’åé å

**è§£å†³æ–¹æ³•**ï¼šè°ƒæ•´æ£€ç´¢æƒé‡

ç¼–è¾‘æ–‡ä»¶ï¼š`server/index.mjs`ï¼Œæ‰¾åˆ° `/api/chunks/search` è·¯ç”±ï¼š

```javascript
// åœ¨è®¡ç®—åˆ†æ•°çš„åœ°æ–¹æ·»åŠ 
const isInterfaceQuery = query.includes("æ¥å£") ||
                        query.includes("interface") ||
                        query.includes("ç«¯å£") ||
                        query.includes("port");

const isStatusQuery = query.includes("çŠ¶æ€") ||
                     query.includes("status") ||
                     query.includes("link");

// ä¸ºæ¥å£çŠ¶æ€æŸ¥è¯¢æ·»åŠ é¢å¤–åŠ åˆ†
if (isInterfaceQuery && isStatusQuery) {
  bonusScore += 0.15;  // æé«˜åŒ¹é…åˆ†æ•°
}

// å¦‚æœchunkå†…å®¹åŒ…å«ç²¾ç¡®å‘½ä»¤ï¼Œé¢å¤–åŠ åˆ†
if (chunk.content.includes("nv show interface") ||
    chunk.content.includes("show interface")) {
  bonusScore += 0.1;
}
```

### æƒ…å†µ4: æŸ¥è¯¢å¢å¼ºä¸è¶³ âš ï¸

**è§£å†³æ–¹æ³•**ï¼šåœ¨æŸ¥è¯¢å¢å¼ºä¸­æ·»åŠ åŒä¹‰è¯æ‰©å±•

ç¼–è¾‘æ–‡ä»¶ï¼š`src/lib/retrievalEnhancements.ts`

```typescript
export function extractCoreQueryEnhanced(query: string, intent: QueryIntent): string {
  // æ·»åŠ åŒä¹‰è¯æ˜ å°„
  const synonymMap = {
    "æ¥å£": ["interface", "port", "ç«¯å£"],
    "çŠ¶æ€": ["status", "state", "link"],
    "æŸ¥è¯¢": ["show", "display", "æŸ¥çœ‹"],
    "ç½‘å£": ["interface", "port"]
  };

  let enhancedQuery = query;

  // å¯¹æŸ¥è¯¢è¿›è¡ŒåŒä¹‰è¯æ‰©å±•
  for (const [chinese, english] of Object.entries(synonymMap)) {
    if (query.includes(chinese)) {
      enhancedQuery += " " + english.join(" ");
    }
  }

  // ç»§ç»­åŸæœ‰çš„é€»è¾‘...
  return enhancedQuery;
}
```

## æŒç»­æ”¹è¿›

### 1. å°†æµ‹è¯•ç”¨ä¾‹æ·»åŠ åˆ°åŸºå‡†æµ‹è¯•

ç¼–è¾‘ `test/benchmark_precision.mjs`ï¼Œæ·»åŠ ï¼š

```javascript
const ALL_TEST_CASES = [
  // ... ç°æœ‰ç”¨ä¾‹

  // æ¥å£çŠ¶æ€æŸ¥è¯¢ç”¨ä¾‹
  {
    query: "å¦‚ä½•æŸ¥è¯¢æ¥å£çŠ¶æ€",
    expected: ["nv show interface", "interface status"],
    minRank: 5,
    type: "command"
  },
  {
    query: "æ€ä¹ˆæŸ¥çœ‹ç«¯å£çŠ¶æ€",
    expected: ["nv show interface", "port status"],
    minRank: 5,
    type: "command"
  },
  {
    query: "nv show interface",
    expected: ["nv show interface"],
    minRank: 1,
    type: "exact_command"
  }
];
```

### 2. å®šæœŸè¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œå®Œæ•´çš„åŸºå‡†æµ‹è¯•
npm run test:benchmark

# è¿è¡Œæ¥å£çŠ¶æ€ä¸“é¡¹æµ‹è¯•
node test/interface-status-query-test.mjs
```

### 3. ç›‘æ§å‡†ç¡®ç‡

ç›®æ ‡å‡†ç¡®ç‡ï¼š
- **ä¼˜ç§€**: â‰¥ 80%
- **è‰¯å¥½**: 60-80%
- **éœ€æ”¹è¿›**: < 60%

## éªŒè¯ä¿®å¤æ•ˆæœ

å®Œæˆä¸Šè¿°ä¼˜åŒ–åï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤éªŒè¯ï¼š

1. **é‡å¯æœåŠ¡**
```bash
npm run server
```

2. **è¿è¡Œæµ‹è¯•**
```bash
node test/interface-status-query-test.mjs
```

3. **æ£€æŸ¥ç»“æœ**
- æŸ¥çœ‹é€šè¿‡ç‡æ˜¯å¦æå‡
- ç¡®è®¤è¯Šæ–­æŠ¥å‘Šä¸­çš„é—®é¢˜æ˜¯å¦å‡å°‘
- éªŒè¯åˆ†ç±»ç»Ÿè®¡ä¸­å„ç±»æŸ¥è¯¢çš„å‡†ç¡®ç‡

4. **å®é™…æµ‹è¯•**
åœ¨Webç•Œé¢ä¸­å®é™…è¾“å…¥æŸ¥è¯¢ï¼š
- "å¦‚ä½•æŸ¥è¯¢æ¥å£çŠ¶æ€"
- "æ€ä¹ˆæŸ¥çœ‹ç«¯å£çŠ¶æ€"
- "æŸ¥çœ‹swp1æ¥å£çŠ¶æ€"

æŸ¥çœ‹è¿”å›ç»“æœæ˜¯å¦å‡†ç¡®å’Œç›¸å…³ã€‚

## æŠ€æœ¯ç»†èŠ‚

### æµ‹è¯•æµç¨‹

```
ç”¨æˆ·æŸ¥è¯¢
    â†“
è°ƒç”¨ /api/chunks/search
    â†“
æ£€ç´¢ç³»ç»Ÿå¤„ç†
  â”œâ”€ æ„å›¾è¯†åˆ«
  â”œâ”€ å…³é”®è¯æå–
  â”œâ”€ å‘é‡æ£€ç´¢
  â”œâ”€ å…³é”®è¯æ£€ç´¢
  â”œâ”€ RRFèåˆ
  â”œâ”€ Reranké‡æ’
  â””â”€ è¿”å›Top 20ç»“æœ
    â†“
æµ‹è¯•éªŒè¯
  â”œâ”€ æ£€æŸ¥æ˜¯å¦åŒ…å«æœŸæœ›å†…å®¹
  â”œâ”€ éªŒè¯æ’åæ˜¯å¦ç¬¦åˆè¦æ±‚
  â”œâ”€ åˆ†æåˆ†æ•°å’ŒåŒ¹é…æƒ…å†µ
  â””â”€ ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
```

### è¯„åˆ†æ ‡å‡†

- **é€šè¿‡**: æ‰¾åˆ°ç›¸å…³å†…å®¹ä¸”æ’å â‰¤ minRank
- **éƒ¨åˆ†é€šè¿‡**: æ‰¾åˆ°ç›¸å…³å†…å®¹ä½†æ’å > minRank
- **å¤±è´¥**: æœªæ‰¾åˆ°ç›¸å…³å†…å®¹æˆ–APIé”™è¯¯

## æ•…éšœæ’é™¤

### é—®é¢˜: "fetch failed" é”™è¯¯

**åŸå› **: åç«¯æœåŠ¡æœªè¿è¡Œ

**è§£å†³**:
```bash
npm run server
```

### é—®é¢˜: "no_results" - 0ä¸ªç»“æœ

**åŸå› **: çŸ¥è¯†åº“ä¸ºç©ºæˆ–æ— ç›¸å…³æ–‡æ¡£

**è§£å†³**:
1. è®¿é—® http://localhost:8787 (å‰ç«¯ç•Œé¢)
2. ä¸Šä¼ æ¥å£ç®¡ç†ç›¸å…³æ–‡æ¡£
3. ç­‰å¾…å¤„ç†å®Œæˆ
4. é‡æ–°æµ‹è¯•

### é—®é¢˜: "no_match" - ç»“æœä¸ç›¸å…³

**åŸå› **: å…³é”®è¯æå–æˆ–æƒé‡é—®é¢˜

**è§£å†³**: æŒ‰ç…§ä¸Šè¿°"æƒ…å†µ2"å’Œ"æƒ…å†µ3"çš„æ–¹æ³•ä¼˜åŒ–

### é—®é¢˜: æ’ååä½

**åŸå› **: Rerankæˆ–RRFæƒé‡ä¸åˆç†

**è§£å†³**: è°ƒæ•´ `server/index.mjs` ä¸­çš„æƒé‡å‚æ•°

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

æ ¹æ®æµ‹è¯•ç»“æœï¼Œå»ºè®®æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§è¿›è¡Œä¼˜åŒ–ï¼š

### ğŸ”´ P0 (ç´§æ€¥)
å¦‚æœæµ‹è¯•æ˜¾ç¤º "no_results"ï¼š
- ç«‹å³ä¸Šä¼ ç›¸å…³æ–‡æ¡£åˆ°çŸ¥è¯†åº“

### ğŸŸ¡ P1 (é‡è¦)
å¦‚æœæµ‹è¯•æ˜¾ç¤º "no_match"ï¼š
- ä¼˜åŒ–å…³é”®è¯æå–å™¨
- è°ƒæ•´æ£€ç´¢æƒé‡

### ğŸŸ¢ P2 (ä¼˜åŒ–)
å¦‚æœæµ‹è¯•æ˜¾ç¤ºæ’ååä½ï¼š
- å¾®è°ƒRerankå‚æ•°
- ä¼˜åŒ–RRFèåˆç­–ç•¥

## è”ç³»ä¸åé¦ˆ

å¦‚æœé‡åˆ°é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥å¸®åŠ©ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æµ‹è¯•è¾“å‡ºçš„è¯¦ç»†è¯Šæ–­æŠ¥å‘Š
2. æ£€æŸ¥ `test/interface-status-query-test.mjs` ä¸­çš„æµ‹è¯•ç”¨ä¾‹æ˜¯å¦ç¬¦åˆä½ çš„éœ€æ±‚
3. æ ¹æ®è¯Šæ–­å»ºè®®é€æ­¥ä¼˜åŒ–ç³»ç»Ÿ
